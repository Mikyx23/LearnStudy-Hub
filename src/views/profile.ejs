<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil del Estudiante - Learnstudy-Hub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/views/css/layout.css">
    <link rel="stylesheet" href="/views/css/perfil.css">
</head>

<body>
    <%- include('partials/_sidebar') %>
    <%- include('partials/_header') %>
    <div class="container">
        <div class="profile-card">
            <div class="profile-image">
                <img src="<%= user.foto_perfil || '/images/default-avatar.svg' %>" alt="Foto de perfil">
                
                <form id="upload-form" action="/api/perfil/foto-perfil" method="POST" enctype="multipart/form-data">
                    <label for="fotoPerfil" class="upload-overlay">
                        <i data-lucide="camera"></i>
                    </label>
                    <input type="file" id="fotoPerfil" name="fotoPerfil" accept="image/*" onchange="this.form.submit()" style="display: none;">
                </form>
            </div>
            <div class="profile-info">
                <h1>
                    <%= user.name %>
                        <%= user.lastname %>
                </h1>
                <p>
                    <%= user.code %> - <%= user.career %>
                </p>

                <div class="info-grid">
                    <div class="info-item">
                        <label>Cedula</label>
                        <span>
                            <%= user.cedula %>
                        </span>
                    </div>
                    <div class="info-item">
                        <label>Correo Electrónico</label>
                        <span>
                            <%= user.email %>
                        </span>
                    </div>
                    <div class="info-item">
                        <label>Semestre Actual</label>
                        <span>
                            <%= user.current_semester || 1 %>
                        </span>
                    </div>
                    <div class="info-item">
                        <label>Promedio General</label>
                        <span>
                            <%= Number(average).toFixed(2) %>
                        </span>
                    </div>
                    <div class="info-item">
                        <label>UCA</label>
                        <span>
                            <%= user.uca %>
                        </span>
                    </div>
                    <div class="info-item">
                        <label>UCC</label>
                        <span>
                            <%= user.ucc %>
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <% const todasLasNotasNull=subject.every(obj=> obj.nota === null); %>
            <% if (subject && subject.length> 0 && !todasLasNotasNull) { %>
                <div class="grades-section">
                    <h2 class="section-title">Historial Académico </h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Materia</th>
                                <th>Semestre</th>
                                <th>UC</th>
                                <th>Calificación</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% subject.forEach(materia=> { %>
                                <% if(materia.nota){ %>
                                    <tr>
                                        <td data-label="Materia">
                                            <%= materia.subject_name %>
                                        </td>
                                        <td>
                                            <%= materia.subject_semester %>
                                        </td>
                                        <td data-label="UC">
                                            <%= materia.uc %>
                                        </td>
                                        <td data-label="Calificación">
                                            <strong>
                                                <%= materia.nota %>
                                            </strong>
                                        </td>
                                        <td data-label="Estado">
                                            <% if (materia.nota>= 10) { %>
                                                <span class="status passed">Aprobado</span>
                                            <% } else { %>
                                                <span class="status failed">Reprobado</span>
                                            <% } %>
                                        </td>
                                    </tr>
                                <% } %>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            <% } else { %>
                <div class="no-data-message">
                    <p>No se encontraron calificaciones registradas</p>
                </div>
            <% } %>
    </div>
    <%- include('partials/_footer') %>
    <script src="https://unpkg.com/lucide@latest"></script>
</body>

</html>