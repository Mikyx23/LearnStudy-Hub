<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda/Evaluaciones - LearnStudy-Hub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Outfit:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/views/css/layout.css">
    <link rel="stylesheet" href="/views/css/agenda.css">
</head>
<body>
<main class="main-container">

<!-- Secci贸n Agenda -->
    <div class="contenedor-angeda" id="agenda">
        <h1>Recordatorio de Evaluaciones</h1>
        
        <form id="formulario-evaluaciones" method="POST" action="/api/agenda/registrar"> 
            <!-- Campos generales -->
            <div class="form-row">
                <div class="form-group">
                    <label for="asignatura">Asignatura:</label>
                    <select id="asignatura" name="asignatura_id" required>
                        <option value="">Seleccione una asignatura</option>
                        <% asignaturas.forEach(function(asig) { %>
                            <option value="<%= asig.id %>"><%= asig.nombre %></option>
                        <% }); %>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="corte">Corte:</label>
                    <select id="corte" name="corte" required>
                        <option value="">Seleccione un corte</option>
                        <option value="1">Corte 1 (M谩x 30%)</option>
                        <option value="2">Corte 2 (M谩x 30%)</option>
                        <option value="3">Corte 3 (M谩x 40%)</option>
                    </select>
                </div>
            </div>
            
            <!-- Contenedor de evaluaci贸n -->
            <div class="evaluaciones-container">
                <div class="evaluacion-group evaluacion-unica">
                    <h3><i class="fas fa-edit"></i> Nueva Evaluaci贸n</h3>
                    <div class="form-group">
                        <label for="descripcion_evaluacion">Nombre/Descripci贸n:</label>
                        <textarea id="descripcion_evaluacion" name="descripcion" placeholder="Nombre o detalles de la evaluaci贸n..." rows="2" required maxlength="30" oninput="contarCaracteres(this)"></textarea>
                        <small id="contador-caracteres" style="color: #666; display: block; text-align: right; margin-top: 5px;">0/30 caracteres</small>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="porcentaje_evaluacion">Porcentaje (%):</label>
                            <input type="number" id="porcentaje_evaluacion" name="porcentaje" min="1" max="40" required>
                        </div>
                        <div class="form-group">
                            <label for="fecha_evaluacion">Fecha:</label>
                            <input type="date" id="fecha_evaluacion" name="fecha" required>
                        </div>
                    </div>
                </div>
            </div>
            
            <button id="agregar">Agregar Evaluaci贸n</button>
        </form>
        
        <!-- Encabezados de la lista -->
        <div class="encabezados-lista">
            <span>Asignatura</span>
            <span>Corte</span>
            <span>Estado</span>
            <span>Nombre</span>
            <span>Porcentaje</span>
            <span>Fecha</span>
        </div>

        <!-- Lista de evaluaciones (se renderiza din谩micamente) -->
        <ul id="lista-examenes">
            <!-- Las evaluaciones se cargan din谩micamente con JavaScript -->
        </ul>

        <!-- Paginaci贸n -->
        <div id="paginacion" class="paginacion-container">
            <button id="btn-prev-pag" class="btn-pag">Anterior</button>
            <div id="numeros-paginas" class="numeros-paginas"></div>
            <button id="btn-next-pag" class="btn-pag">Siguiente</button>
        </div>
    </div>

    <!-- Secci贸n Calendario -->
    <section class="calendario-section" id="calendario">
        <div class="calendario-container">
            <h2><i class="fas fa-calendar-alt"></i> Calendario de Evaluaciones</h2>
            
            <!-- Filtros y controles -->
            <div class="calendario-controls">
                <div class="filtros">
                    <div class="filtro-group">
                        <label for="filtro-mes">Mes:</label>
                        <select id="filtro-mes">
                            <option value="todos">Todos los meses</option>
                            <option value="0">Enero</option>
                            <option value="1">Febrero</option>
                            <option value="2">Marzo</option>
                            <option value="3">Abril</option>
                            <option value="4">Mayo</option>
                            <option value="5">Junio</option>
                            <option value="6">Julio</option>
                            <option value="7">Agosto</option>
                            <option value="8">Septiembre</option>
                            <option value="9">Octubre</option>
                            <option value="10">Noviembre</option>
                            <option value="11">Diciembre</option>
                        </select>
                    </div>
                    <div class="filtro-group">
                        <label for="filtro-asignatura">Asignatura:</label>
                        <select id="filtro-asignatura">
                            <option value="todos">Todas las asignaturas</option>
                        </select>
                    </div>
                    <div class="filtro-group">
                        <label for="filtro-corte">Corte:</label>
                        <select id="filtro-corte">
                            <option value="todos">Todos los cortes</option>
                            <option value="corte1">Corte 1</option>
                            <option value="corte2">Corte 2</option>
                            <option value="corte3">Corte 3</option>
                        </select>
                    </div>
                </div>
                
                <div class="calendario-nav">
                    <button id="btn-hoy" class="btn-calendario">
                        <i class="fas fa-calendar-day"></i> Hoy
                    </button>
                    <button id="btn-prev-mes" class="btn-calendario">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span id="mes-actual" class="mes-actual">Enero 2024</span>
                    <button id="btn-next-mes" class="btn-calendario">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
            
            <!-- Vista de calendario -->
            <div class="calendario-vista">
                <!-- Cabecera d铆as de la semana -->
                <div class="calendario-dias-semana">
                    <div class="dia-semana">Dom</div>
                    <div class="dia-semana">Lun</div>
                    <div class="dia-semana">Mar</div>
                    <div class="dia-semana">Mi茅</div>
                    <div class="dia-semana">Jue</div>
                    <div class="dia-semana">Vie</div>
                    <div class="dia-semana">S谩b</div>
                </div>
                
                <!-- D铆as del mes -->
                <div id="calendario-dias" class="calendario-dias"></div>
            </div>
            
            <!-- Leyenda -->
            <div class="calendario-leyenda">
                <div class="leyenda-item">
                    <span class="leyenda-color" style="background-color: #3b82f6; width: 16px; height: 16px;"></span>
                    <span>Corte 1</span>
                </div>
                <div class="leyenda-item">
                    <span class="leyenda-color" style="background-color: #f59e0b; width: 16px; height: 16px;"></span>
                    <span>Corte 2</span>
                </div>
                <div class="leyenda-item">
                    <span class="leyenda-color" style="background-color: #8b5cf6; width: 16px; height: 16px;"></span>
                    <span>Corte 3</span>
                </div>
                <div class="leyenda-item">
                    <small> Click en los cuadros para ver detalles</small>
                </div>
            </div>
            
            <!-- Pr贸ximas evaluaciones -->
            <div class="proximas-evaluaciones">
                <h3><i class="fas fa-clock"></i> Pr贸ximas Evaluaciones Pendientes</h3>
                <div id="lista-proximas" class="lista-proximas">
                    <!-- Las pr贸ximas evaluaciones se cargar谩n aqu铆 -->
                </div>
            </div>
        </div>
    </section>
</main>

<script>
    const DATOS_INICIALES_DEL_SERVIDOR = <%- JSON.stringify(todasLasEvaluaciones || []) %>;
</script>

<script src="https://unpkg.com/lucide@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="/views/javascript/layout.js"></script>
<script src="/views/javascript/agenda.js"></script>
</body>
</html>