<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda/Evaluaciones - LearnStudy-Hub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Outfit:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/views/css/layout.css">
    <link rel="stylesheet" href="/views/css/agenda.css">
</head>
<body>

<!-- Sección Agenda -->
    <div class="contenedor-angeda" id="agenda">
        <h1>Recordatorio de Evaluaciones</h1>
        <form  id="formulario-evaluaciones" method="POST" action="/api/agenda/registrar"> 
            <!-- Campos generales -->
            <div class="form-row">
                <div class="form-group">
                    <label for="asignatura">Asignatura:</label>
                    <select id="asignatura" name="asignatura_id" required>
                        <option value="">Seleccione una asignatura</option>
                        <% asignaturas.forEach(function(asig) { %>
                            <option value="<%= asig.id %>"><%= asig.nombre %></option>
                        <% }); %>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="corte">Corte:</label>
                    <select id="corte" name="corte" required>
                        <option value="">Seleccione un corte</option>
                        <option value="1">Corte 1 (Máx 30%)</option>
                        <option value="2">Corte 2 (Máx 30%)</option>
                        <option value="3">Corte 3 (Máx 40%)</option>
                    </select>
                </div>
            </div>
            
            <!-- Contenedor de evaluaciones lado a lado -->
            <div class="evaluaciones-container">
                <div class="evaluacion-group evaluacion-unica">
                    <h3><i class="fas fa-edit"></i> Nueva Evaluación</h3>
                    <div class="form-group">
                        <label for="descripcion_evaluacion">Descripción:</label>
                        <textarea id="descripcion_evaluacion" name="descripcion" placeholder="Detalles de la evaluación..." rows="2"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="porcentaje_evaluacion">Porcentaje (%):</label>
                            <input type="number" id="porcentaje_evaluacion" name="porcentaje" min="1" max="40" required>
                        </div>
                        <div class="form-group">
                            <label for="fecha_evaluacion">Fecha:</label>
                            <input type="date" id="fecha_evaluacion" name="fecha" required>
                        </div>
                    </div>
                </div>
            </div>
            
            <button id="agregar">Agregar Evaluaciones</button>
        </form>
        
        <!-- Encabezados de la lista -->
        <div class="encabezados-lista">
            <span>Asignatura</span>
            <span>Corte</span>
            <span>Evaluación</span>
            <span>Nombre</span>
            <span>Porcentaje</span>
            <span>Fecha</span>
        </div>
        
        <ul id="lista-examenes">
            <% if (evaluaciones && evaluaciones.length > 0) { %>
                <% evaluaciones.forEach(function(eval) { %>
                    <li class="examen-item" data-id="<%= eval.id %>">
                        <span><%= eval.asignatura_nombre %></span>
                        <span>Corte <%= eval.corte %></span>
                        <span><i class="fas fa-file-alt"></i></span>
                        <span><%= eval.nombre %></span>
                        <span><%= eval.porcentaje %>%</span>
                        <span><%= new Date(eval.fecha).toLocaleDateString() %></span>
                        <span>
                            </span>
                    </li>
                <% }); %>
            <% } else { %>
                <li class="sin-evaluaciones">
                    <p>No existen evaluaciones registradas actualmente.</p>
                </li>
            <% } %>
            </ul>
    </div>

    <!-- Sección Calendario -->
    <section class="calendario-section" id="calendario">
        <div class="calendario-container">
            <h2><i class="fas fa-calendar-alt"></i> Calendario de Evaluaciones</h2>
            
            <!-- Filtros y controles -->
            <div class="calendario-controls">
                <div class="filtros">
                    <div class="filtro-group">
                        <label for="filtro-mes">Mes:</label>
                        <select id="filtro-mes">
                            <option value="todos">Todos los meses</option>
                            <option value="0">Enero</option>
                            <option value="1">Febrero</option>
                            <option value="2">Marzo</option>
                            <option value="3">Abril</option>
                            <option value="4">Mayo</option>
                            <option value="5">Junio</option>
                            <option value="6">Julio</option>
                            <option value="7">Agosto</option>
                            <option value="8">Septiembre</option>
                            <option value="9">Octubre</option>
                            <option value="10">Noviembre</option>
                            <option value="11">Diciembre</option>
                        </select>
                    </div>
                    <div class="filtro-group">
                        <label for="filtro-asignatura">Asignatura:</label>
                        <select id="filtro-asignatura">
                            <option value="todos">Todas las asignaturas</option>
                        </select>
                    </div>
                    <div class="filtro-group">
                        <label for="filtro-corte">Corte:</label>
                        <select id="filtro-corte">
                            <option value="todos">Todos los cortes</option>
                            <option value="corte1">Corte 1</option>
                            <option value="corte2">Corte 2</option>
                            <option value="corte3">Corte 3</option>
                        </select>
                    </div>
                </div>
                
                <div class="calendario-nav">
                    <button id="btn-hoy" class="btn-calendario">
                        <i class="fas fa-calendar-day"></i> Hoy
                    </button>
                    <button id="btn-prev-mes" class="btn-calendario">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span id="mes-actual" class="mes-actual">Enero 2024</span>
                    <button id="btn-next-mes" class="btn-calendario">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    <button id="btn-vista-mes" class="btn-calendario active">
                        <i class="fas fa-calendar"></i> Mes
                    </button>
                    <button id="btn-vista-semana" class="btn-calendario">
                        <i class="fas fa-calendar-week"></i> Semana
                    </button>
                </div>
            </div>
            
            <!-- Vista de calendario -->
            <div class="calendario-vista">
                <!-- Cabecera días de la semana -->
                <div class="calendario-dias-semana">
                    <div class="dia-semana">Dom</div>
                    <div class="dia-semana">Lun</div>
                    <div class="dia-semana">Mar</div>
                    <div class="dia-semana">Mié</div>
                    <div class="dia-semana">Jue</div>
                    <div class="dia-semana">Vie</div>
                    <div class="dia-semana">Sáb</div>
                </div>
                
                <!-- Días del mes -->
                <div id="calendario-dias" class="calendario-dias"></div>
            </div>
            
            <!-- Leyenda -->
            <div class="calendario-leyenda">
                <div class="leyenda-item">
                    <span class="leyenda-color" style="background-color: #3b82f6;"></span>
                    <span>Evaluación 1</span>
                </div>
                <div class="leyenda-item">
                    <span class="leyenda-color" style="background-color: #10b981;"></span>
                    <span>Evaluación 2</span>
                </div>
                <div class="leyenda-item">
                    <span class="leyenda-color corte1"></span>
                    <span>Corte 1</span>
                </div>
                <div class="leyenda-item">
                    <span class="leyenda-color corte2"></span>
                    <span>Corte 2</span>
                </div>
                <div class="leyenda-item">
                    <span class="leyenda-color corte3"></span>
                    <span>Corte 3</span>
                </div>
            </div>
            
            <!-- Próximas evaluaciones -->
            <div class="proximas-evaluaciones">
                <h3><i class="fas fa-clock"></i> Próximas Evaluaciones</h3>
                <div id="lista-proximas" class="lista-proximas">
                    <!-- Las próximas evaluaciones se cargarán aquí -->
                </div>
            </div>
        </div>
    </section>

    <script>
        // Usamos un nombre único para evitar el error de "already declared"
        const DATOS_INICIALES_DEL_SERVIDOR = <%- JSON.stringify(todasLasEvaluaciones) %>;
    </script>   
<!-- El JavaScript permanece igual -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/views/javascript/layout.js" ></script>
    <script src="/views/javascript/agenda.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>