<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malla Curricular - Learnstudy-Hub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/views/css/layout.css">
    <link rel="stylesheet" href="/views/css/malla.css">
    <script src="/views/javascript/layout.js" ></script>
</head>
<body>
    <main class="app-content">
        <div id="info-alerta" class="alert alert-info d-none" style="position: sticky; top: 10px; z-index: 100;">
        </div>
        <div class="malla">
            <div class="malla__grid" id="gridContainer">
                <% 
                // Función auxiliar para romanos
                const toRomano = (num) => ["I", "II", "III", "IV", "V", "VI", "VII", "VIII", "IX", "X"][num - 1];
                
                // Iteramos por los 10 semestres
                for(let i = 1; i <= 10; i++) { 
                    // Filtramos las materias que pertenecen a este semestre
                    const materiasDelSemestre = pensum.filter(a => a.semestre === i);
                %>
                    <div id="semestre<%= i %>" class="malla__semestre">
                        <% if (materiasDelSemestre.length > 0) { %>
                            <div class="semestre__header">
                                <h2>Semestre <%= toRomano(i) %></h2>
                            </div>
                        <% } %>

                        <% materiasDelSemestre.forEach(asignatura => { %>
                            <div class="asignatura-card" 
                                data-codigo="<%= String(asignatura.codigo).trim() %>"
                                onclick="ClickAsignatura('<%= String(asignatura.codigo).trim() %>')">
                                
                                <div class="card-header">
                                    <span class="codigo-badge"><%= asignatura.codigo %></span>
                                    <span class="uc-badge"><%= asignatura.UC %> UC</span>
                                </div>
                                <div class="nombre-asignatura"><%= asignatura.nombre %></div>
                            </div>
                        <% }); %>
                    </div>
                <% } %>
            </div>
        </div>
    </main>
<script>
    const pensum = <%- JSON.stringify(pensum) %>.map(m => {
        // Convertimos TODO a string explícitamente usando String()
        const codigoTexto = String(m.codigo || "").trim();
        const reqStr = String(m.requisitos || "").trim();
        const corrStr = String(m.correquisitos || "").trim();

        return {
            ...m,
            codigo: codigoTexto,
            // Convertimos cada código de la lista también a string
            requisitos: reqStr.split(',').map(c => String(c).trim()).filter(c => c !== ""),
            correquisitos: corrStr.split(',').map(c => String(c).trim()).filter(c => c !== ""),
            UCA: parseInt(m.UCA) || 0
        };
    });
</script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script type="module" src="/views/javascript/malla.js"></script>
</body>
</html>